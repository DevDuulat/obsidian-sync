
В этом уроке мы добавим функциональность динамических страниц, используя файлы Markdown. Это позволит нам создавать страницы, не прибегая к базе данных.

### Создание контроллера Page

Сначала создайте контроллер `Page`:

```php
<?php declare(strict_types = 1);

namespace Example\Controllers;

class Page
{
    public function show($params)
    {
        var_dump($params);
    }
}
```

### Добавление маршрута

Затем добавьте новый маршрут в ваш `Routes.php`:

```php
['GET', '/{slug}', ['Example\Controllers\Page', 'show']],
```

Теперь вы можете посетить URL-адреса, такие как `http://localhost:8000/test` или `http://localhost:8000/hello`, и увидите, что контроллер `Page` вызывается, а массив `$params` получает значение `slug`.

### Создание файлов страниц

Создайте папку `pages` в корневом каталоге вашего проекта и добавьте туда несколько файлов с расширением `.md`. Например, создайте файл `page-one.md` со следующим содержимым:

```
This is a page.
```

### Создание интерфейса PageReader

Создайте новый каталог `Page` в папке `src`, а затем добавьте файл `PageReader.php`:

```php
<?php declare(strict_types = 1);

namespace Example\Page;

interface PageReader
{
    public function readBySlug(string $slug) : string;
}
```

### Реализация FilePageReader

Теперь создайте файл `FilePageReader.php` в той же папке:

```php
<?php declare(strict_types = 1);

namespace Example\Page;

use InvalidArgumentException;

class FilePageReader implements PageReader
{
    private $pageFolder;

    public function __construct(string $pageFolder)
    {
        $this->pageFolder = $pageFolder;
    }

    public function readBySlug(string $slug) : string
    {
        return 'I am a placeholder';
    }
}
```

### Настройка зависимостей

Добавьте в `Dependencies.php` следующие строки:

```php
$injector->define('Example\Page\FilePageReader', [
    ':pageFolder' => __DIR__ . '/../pages',
]);

$injector->alias('Example\Page\PageReader', 'Example\Page\FilePageReader');
$injector->share('Example\Page\FilePageReader');
```

### Обновление контроллера Page

Измените метод `show` в контроллере `Page` следующим образом:

```php
public function show($params)
{
    $slug = $params['slug'];
    $data['content'] = $this->pageReader->readBySlug($slug);
    $html = $this->renderer->render('Page', $data);
    $this->response->setContent($html);
}
```

### Инъекция зависимостей в контроллер

Не забудьте обновить конструктор контроллера `Page`, чтобы инъектировать `Response`, `Renderer` и `PageReader`:

```php
public function __construct(
    Response $response,
    Renderer $renderer,
    PageReader $pageReader
) {
    $this->response = $response;
    $this->renderer = $renderer;
    $this->pageReader = $pageReader;
}
```

### Обработка отсутствующих страниц

Создайте файл `InvalidPageException.php` в папке `src/Page`:

```php
<?php declare(strict_types = 1);

namespace Example\Page;

use Exception;

class InvalidPageException extends Exception
{
    public function __construct($slug, $code = 0, Exception $previous = null)
    {
        $message = "No page with the slug `$slug` was found";
        parent::__construct($message, $code, $previous);
    }
}
```

Теперь измените метод `readBySlug` в `FilePageReader.php`:

```php
public function readBySlug(string $slug) : string
{
    $path = "$this->pageFolder/$slug.md";

    if (!file_exists($path)) {
        throw new InvalidPageException($slug);
    }

    return file_get_contents($path);
}
```

### Обработка исключений в контроллере

Теперь измените метод `show` в контроллере `Page`, чтобы обработать исключение:

```php
public function show($params)
{
    $slug = $params['slug'];

    try {
        $data['content'] = $this->pageReader->readBySlug($slug);
    } catch (InvalidPageException $e) {
        $this->response->setStatusCode(404);
        return $this->response->setContent('404 - Page not found');
    }
    
    $html = $this->renderer->render('Page', $data);
    $this->response->setContent($html);
}
```

### Проверка работоспособности

Теперь вы можете попробовать разные URL-адреса, чтобы убедиться, что все работает как задумано. Если что-то не так, отладьте код, чтобы все заработало. Не забудьте зафиксировать изменения!