
Шаблонизация не является обязательной в PHP, но может значительно упростить задачу. В этом уроке мы будем использовать реализацию Mustache и адаптерный паттерн для создания интерфейса, который будет минимально зависим от конкретной реализации.

### Установка Mustache

Сначала установите пакет Mustache через Composer:

```bash
composer require mustache/mustache
```

### Создание интерфейса Renderer

1. Создайте папку `Template` в каталоге `src/`.
2. Внутри создайте файл `Renderer.php`:

```php
<?php declare(strict_types = 1);

namespace Example\Template;

interface Renderer
{
    public function render($template, $data = []) : string;
}
```

### Реализация MustacheRenderer

Создайте файл `MustacheRenderer.php` в той же папке:

```php
<?php declare(strict_types = 1);

namespace Example\Template;

use Mustache_Engine;

class MustacheRenderer implements Renderer
{
    private $engine;

    public function __construct(Mustache_Engine $engine)
    {
        $this->engine = $engine;
    }

    public function render($template, $data = []) : string
    {
        return $this->engine->render($template, $data);
    }
}
```

### Настройка зависимостей

Добавьте в `Dependencies.php` следующий код для связывания интерфейса с реализацией:

```php
$injector->alias('Example\Template\Renderer', 'Example\Template\MustacheRenderer');
```

### Обновление контроллера Homepage

Теперь обновите контроллер `Homepage`:

```php
<?php declare(strict_types = 1);

namespace Example\Controllers;

use Http\Request;
use Http\Response;
use Example\Template\Renderer;

class Homepage
{
    private $request;
    private $response;
    private $renderer;

    public function __construct(
        Request $request, 
        Response $response,
        Renderer $renderer
    ) {
        $this->request = $request;
        $this->response = $response;
        $this->renderer = $renderer;
    }

    public function show()
    {
        $data = [
            'name' => $this->request->getParameter('name', 'stranger'),
        ];
        $html = $this->renderer->render('Homepage', $data);
        $this->response->setContent($html);
    }
}
```

### Настройка Mustache для работы с файлами

Теперь измените `Dependencies.php`, чтобы передать параметры для использования файловых шаблонов:

```php
$injector->define('Mustache_Engine', [
    ':options' => [
        'loader' => new Mustache_Loader_FilesystemLoader(dirname(__DIR__) . '/templates', [
            'extension' => '.html',
        ]),
    ],
]);
```

### Создание шаблона

1. В корневой папке проекта создайте папку `templates`.
2. В ней создайте файл `Homepage.html` со следующим содержимым:

```html
<h1>Hello World</h1>
Hello {{ name }}
```

### Проверка работоспособности

Теперь вы можете перейти к вашему контроллеру и изменить строку рендеринга на:

```php
$html = $this->renderer->render('Homepage', $data);
```

Затем проверьте, работает ли все в вашем браузере, перейдя по адресу [http://localhost:8000/](http://localhost:8000/). Не забудьте зафиксировать изменения!